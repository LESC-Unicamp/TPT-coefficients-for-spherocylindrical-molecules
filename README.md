```
                                    ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣀⣤⣤⣴⣶⡆⠀⣶⣶⣦⣤⣤⣄⠀ ⢠⣾⣿⣦
                                    ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⡀⢰⣿⣿⣿⣿⣿⣿⣿⡇⠀⣿⣿⣿⣿⣿⣿⡄⠘⢿⣿⠟
                                    ⠀⠀⠀⠀⠀⠀⠀⠀⢀⣴⣾⣿⣧⠀⢻⣿⣿⣿⣿⣿⣿⡇⠀⣿⣿⣿⣿⣿⣿⣿⠂⢠⣠⣤⣶⣦⡀
                                    ⠀⠀⠀⠀⠀⠀⣠⣾⣿⣿⣿⣿⣿⣇⠈⢿⣿⣿⣿⣿⣿⡇⠀⣿⣿⣿⣿⣿⣿⠏⢀⣿⣿⣿⣿⣿⣿⣦⡀
                                    ⠀⠀⠀⠀⠀⠘⢿⣿⣿⣿⣿⣿⣿⣿⡆⠘⣿⣿⣿⣿⣿⡇⠀⣿⣿⣿⣿⣿⡏⠀⣾⣿⣿⣿⣿⣿⣿⡿⠋⢀
                                    ⠀⠀⠀⣴⣿⣦⡀⠙⢿⣿⣿⣿⣿⣿⣿⡄⠸⣿⣿⣿⣿⡇⠀⣿⣿⣿⣿⡟⠀⣼⣿⣿⣿⣿⣿⣿⠟⢀⣴⣿⣧
                                    ⠀⠀⣼⣿⣿⣿⣿⣦⡀⠙⢿⣿⣿⣿⣿⣷⡀⢹⣿⣿⣿⡇⠀⣿⣿⣿⡿⠁⣰⣿⣿⣿⣿⣿⠟⢁⣴⣿⣿⣿⣿⣧
                                    ⠀⣼⣿⣿⣿⣿⣿⣿⣿⣦⡀⠙⢿⣿⣿⣿⣧⠀⢻⣿⣿⡇⠀⣿⣿⣿⠃⢰⣿⣿⣿⣿⠟⢁⣴⣿⣿⣿⣿⣿⣿⣿⣧
                                    ⠀⠛⠿⢿⣿⣿⣿⣿⣿⣿⣿⣦⡀⠙⢿⣿⣿⣇⠀⢿⣿⡇⠀⣿⣿⠇⢠⣿⣿⣿⠟⢁⣴⣿⣿⣿⣿⣿⣿⣿⣿⡿⠟⠃
                                    ⣼⣶⣤⣄⡈⠙⠛⠿⣿⣿⣿⣿⣿⣦⡀⠙⢿⣿⡆⠈⠛⠃⠀⠛⠋⠀⣾⣿⠟⠁⣠⣾⣿⣿⣿⣿⡿⠿⠛⠉⣀⣠⣴⣶⡄
                                    ⣿⣿⣿⣿⣿⣿⣶⣤⣀⡉⠙⠻⢿⣿⣿⣦⠀⠁⠀⠀⠀⠀⠀⠀⠀⠀⠈⠁⢠⣾⣿⣿⠿⠛⠋⢁⣠⣴⣶⣿⣿⣿⣿⣿⣿⡀
                                    ⢻⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⣦⣤⣀⠉⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠋⢁⣀⣤⣶⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣧
                                    ⢸⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡏⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠘⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡟⠁⠀⣠⣶⣄
                                    ⠀⣤⣤⣤⣤⣤⣤⣤⣤⣤⣤⣤⣤⣤⡄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣤⣤⣤⣤⣤⣤⣤⣤⣤⣤⣤⣤⣤⣤⡄⠀ ⢻⣿⣿⡿
                                    ⠀⠘⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠿⠓⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣸⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⠂⠀⠈⠙⠋
                                    ⠀⠀⠘⣿⣿⣿⣿⣿⠿⠛⠋⢁⣠⣤⣶⣧⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢰⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠟⠋
                                    ⠀⠀⠀⠘⠟⠋⢉⣀⣤⣶⣿⣿⣿⣿⠟⠁⣠⣦⣄⡀⠀⠀⠀⠀⠀⠀⣤⣦⡈⠻⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⠛⠁
                                    ⠀⠀⠀⠀⠀⠘⢿⣿⣿⣿⣿⣿⠟⠁⣠⣾⣿⣿⣿⣿⣿⣶⣶⣾⣧⠀⢻⣿⣿⣦⡈⠻⣿⣿⣿⣿⡿⠟⠉
                                    ⠀⠀⠀⠀⠀⠀⠀⠙⠿⣿⡟⠁⣠⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣇⠈⠿⢿⣿⣿⣦⡈⠻⠛⠉
                                    ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠀⠺⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠋⢀⣤⣤⡈⠙⠋⠁
                                    ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠉⠙⠛⠻⠿⠿⠿⠿⠿⠿⠇⠀ ⣿⣿⣿⡇
                                    ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀   ⠈⠙⠋

                         /██   /██   /██   /██   /██████    /██████     /██████    /██      /██   /███████
                        | ██  | ██  | ███ | ██  |_  ██_/   /██__  ██   /██__  ██  | ███    /███  | ██__  ██
                        | ██  | ██  | ████| ██    | ██    | ██  \__/  | ██  \ ██  | ████  /████  | ██  \ ██
                        | ██  | ██  | ██ ██ ██    | ██    | ██        | ████████  | ██ ██/██ ██  | ███████/
                        | ██  | ██  | ██  ████    | ██    | ██        | ██__  ██  | ██  ███| ██  | ██____/
                        | ██  | ██  | ██\  ███    | ██    | ██    ██  | ██  | ██  | ██\  █ | ██  | ██
                        |  ██████/  | ██ \  ██   /██████  |  ██████/  | ██  | ██  | ██ \/  | ██  | ██
                         \______/   |__/  \__/  |______/   \______/   |__/  |__/  |__/     |__/  |__/
```
<p align="right"><b><sub>Version: 1.0.0</sub></b></p>

<p align="center"><b>Authors</b></p>
<p align="center">
Nathan Barros de Souza<br>
Joyce Tavares Lopes<br>
Luís Fernando Mercier Franco<br></p>

# Canonical Monte Carlo algorithm for nonspherical molecules
<p align="justify">
This <i>NVT</i>-Monte Carlo algorithm was originally designed to test an equation of state developed for spherocylindrical molecules
 (<a href="https://doi.org/10.1016/j.molliq.2021.115676">Lopes and Franco, <b>J. Mol. Liq.</b>, 330, 115676, 2021</a>). This thermodynamic model applies a
 perturbation theory, considering the reference fluid as hard spherocylinders interacting via short-range repulsive
 forces according to the Vega-Lago (VL) shortest distance algorithm (<a href="https://doi.org/10.1016/0097-8485(94)80023-5">Vega and Lago, <b>Comput. Chem.</b>, 18, 1, 55-59, 1994</a>)
 and the perturbed system ruled by attractive forces defined by a symmetrically spherical square-well potential or a continuous Kihara potential. Our aim is to investigate
 the valid limits of reduced number density ([1+L/D]&rho;*) and of length-to-diameter aspect ratio (L/D) by calculating the first- and
 second-order perturbation coefficients, as well as the orientational ordering parameter of a uniaxial nematic phase.
</p><br>

## Contents
* <a href="#disclaimer">1. Disclaimer</a>
* <a href="#language">2. Language</a>
* <a href="#building-and-compilation">3. Building and Compilation</a>
* <a href="#reporting-errors">4. Reporting Errors</a>
* <a href="#data-input">5. Data Input</a>
* <a href="#initial-configuration">6. Initial Configuration</a>
* <a href="#files-and-folders">7. Files and Folders</a>
* <a href="#running-the-code">8. Running the Code</a>

## Disclaimer
<p align="justify">
The authors make no warranties about the use of this software. The authors hold no liabilities for the use of this software. The authors do not 
 recommend the use of this software whatsoever. The algorithm is made freely available.
 All information contained herein regarding any specific methodology does not constitute or imply its endorsement or recommendation by the authors.
</p>

## Language
<p align="justify">
The main program, subroutines, modules, and functions contain some explanatory comments and are mainly written in Fortran 95. The user can look for
 more information on Fortran language <a href="https://docs.oracle.com/cd/E19957-01/806-3591/C_f95.html">here</a>.
</p>

## Building and Compilation
<p align="justify">
All programs, subroutines, modules, and functions must be compiled together due to their interdependence. For compilation, we have used
 GFortran, the GNU Fortran compiler, which is part of the GNU Compiler Collection (GCC). See more information on GFortran
 <a href="https://gcc.gnu.org/onlinedocs/gcc-4.4.7/gfortran.pdf">here</a>. We tested the algorithm using two GFortran versions: a GCC version
 9.3.0 in a Windows Subsystem for Linux (Ubuntu 20.04 LTS, Focal Fossa) and a GCC version 8.2.1 in a Red Hat Enterprise Linux OS. Visit the
 <a href="https://gcc.gnu.org/">GCC Website</a> for more information on these versions.
</p>

<p align="justify">
We have built the code using the following command line:
</p>

```console
gfortran -O3 main.f95 functions.f95 subroutines.f95 module_folders.f95 module_global_variables.f95 module_initial_configuration.f95 module_variable_initialization.f95 -o main.out
```

<p align="justify">
The <code>-O3</code> option is an optimization flag that improves compilation performance at the expense of compilation time. It includes all
 optimization options from <code>-O1</code> and <code>-O2</code> flags. Check <a href="https://gcc.gnu.org/onlinedocs/gcc/Optimize-Options.html">this link</a>
 for more details. In some cases, it might be necessary to add the <code>-fno-range-check</code> runtime option to disable range checking of input
 values during integer <code>READ</code> operations. Click <a href="https://gcc.gnu.org/onlinedocs/gcc-4.4.7/gfortran/Runtime-Options.html">here</a>
 for more information.
</p>

## Reporting Errors
<p align="justify">
If you spot an error in the program files and all other documentation, please submit an issue report using the <a href="https://github.com/LESC-Unicamp/TPT-coefficients-for-spherocylindrical-molecules/issues">Issues</a> tab.
</p>

## Data Input
<p align="justify">
Before running the code, the user should first prepare an input file named <code>mcvl_input.ini</code> containing most of the external variables.
 These variables are read by the module <a href="https://github.com/LESC-Unicamp/TPT-coefficients-for-spherocylindrical-molecules/blob/main/module_variable_initialization.f95">Variable Initialization</a>.
 An <a href="https://github.com/LESC-Unicamp/TPT-coefficients-for-spherocylindrical-molecules/blob/main/mcvl_input.ini">example</a> of an input file was provided and explained below
 (<code>d0</code> means double precision):
</p>

```ini
number_of_particles= 500
reduced_temperature= 2.5d0
n_potential_param= 6
n_potential_values= 7.d0 8.d0 9.d0 10.d0 11.d0 12.d0
quaternion_angle= 0.d0
max_steps= 20000000
equilibration= 10000000
n_save= 1000
n_adjust= 200
max_trans= 0.3d0
max_rot= 0.1d0
min_blockav= 600
max_blockav= 1000
trajectory_inquiry= N
coefficient_inquiry= Y
production_inquiry= Y
```

<p align="justify">
The entry <code>number_of_particles</code> corresponds to the number of particles inside your simulation box. This must be a number with
 an exact cube root, which depends on the selected configuration of the crystalline structure: <code>&#8731;N</code> for a simple cubic structure, 
 <code>&#8731;(N/2)</code> for a body-centered cubic structure, and <code>&#8731;(N/4)</code> for a face-centered cubic structure, where N is
 the number of particles.
</p>
<p align="justify">
The entry <code>reduced_temperature</code> corresponds to the reduced thermodynamic temperature <i>T*</i> of the system.
</p>
<p align="justify">
The entry <code>n_potential_param</code> corresponds to the number of attractive range parameters <i>&lambda;</i> of the Square-Well potential or the number of repulsive parameters <i>n</i> of the Kihara potential. For instance, if the user wants to calculate the perturbed potential  
 for six different repulsive parameters (e.g. <i>7</i>, <i>8</i>, <i>9</i>, <i>10</i>, <i>11</i>, and <i>12</i>), then <code>n_potential_param</code> must be equal to <b>6</b>.
</p>
<p align="justify">
The entry <code>n_potential_values</code> corresponds to the values of the attractive range or repulsive parameters. If the user selected multiple <i>n</i> in the previous entry, then all
 corresponding <i>n</i> values must be entered sequentially here, as shown in the example above. It does not necessarily have to be in ascending order.
</p>
<p align="justify">
The entry <code>quaternion_angle</code> corresponds to the rotation angle of the molecules in the initial configuration. It is usually set to <b>0</b>, since all particles
 are initially oriented along the <i>z</i>-axis (body-fixed axis).
</p>
<p align="justify">
The entry <code>max_steps</code> corresponds to the number of simulation cycles.
</p>
<p align="justify">
The entry <code>equilibration</code> corresponds to the number of equilibration cycles. Therefore, the number of production cycles will be <code>max_steps &minus; equilibration</code>.
</p>
<p align="justify">
The entry <code>n_save</code> corresponds to the data saving frequency (inversely proportional relation). It means data will be written out in external files every
 <code>n_save</code> cycles.
</p>
<p align="justify">
The entry <code>n_adjust</code> corresponds to the adjusment frequency of the maximum displacement (inversely proportional relation). It means the maximum displacement
 (rotational and translational) will be adjusted every <code>n_adjust</code> cycles.
</p>
<p align="justify">
The entries <code>max_trans</code> and <code>max_rot</code> correspond to the initial values of the maximum translational displacement and maximum rotational displacement,
 respectively.
</p>
<p align="justify">
The entries <code>min_blockav</code> and <code>max_blockav</code> correspond to minimum and maximum number of blocks used in the block-average subroutine, respectively. They
 are necessary to estimate the statistical inefficiency.
</p>
<p align="justify">
The last three entries are inquiry variables. <code>trajectory_inquiry</code> inquires whether the molecular trajectory (position and orientation) is going to be written out in
 external files. Type <b>N</b> for a negative answer or <b>Y</b> for an affirmative one. The trajectory file is properly formatted to be uploaded in OVITO, a scientific
 visualization and analysis software for atomistic and particle simulation data. <code>coefficient_inquiry</code> inquires whether the block-average subroutine will be
 called at the end of the Monte Carlo simulation to estimate averages and uncertainties of some relevant variables. Type <b>N</b> for a negative answer or <b>Y</b> for an 
 affirmative one. <code>production_inquiry</code> inquires whether only production-related results will be written out in external files. Type <b>Y</b> for only 
 production-related results or <b>N</b> to also include equilibration results.
</p>

<p align="justify">
Reduced number density <code>[1+L/D]&rho;*</code> and length-to-diameter aspect ratio <code>L/D</code> must be provided by the user on the fly.
</p>

## Initial Configuration
<p align="justify">
The user is allowed to select one of three crystalline structures for the initial molecular configuration at the beginning of the simulation. Structures are either stretched or pure cubic geometries depending on the spherocylindrical aspect ratio. The available structures are: simple cube (SC), body-centered cube (BCC), or face-centered cube (FCC). Like <code>[1+L/D]&rho;*</code> and <code>L/D</code> variables, the initial molecular configuration is also provided by the user on the fly.
</p>

<p align="justify">
The initial configuration (position and orientation of particles) is, by default, written out in an external file and is also properly formatted to be uploaded in OVITO. An example of these crystalline structures can be seen below for <code>[1+L/D]&rho;* = 0.5</code>.
</p>

<em><p align="center">
  <b>Figure 01-A</b>. Example of a simple cubic structure. Particles are hard spheres (<code>L/D = 0</code>). Number of particles: 512.<br>
  Click [here](https://user-images.githubusercontent.com/73966482/125833600-f8091b9c-a405-4ae3-9f24-013f221fe0d2.png) to zoom the figure in.
</p></em>

![SC](https://user-images.githubusercontent.com/73966482/125833600-f8091b9c-a405-4ae3-9f24-013f221fe0d2.png)

<em><p align="center">
  <b>Figure 01-B</b>. Example of a narrowed body-centered cubic structure. Particles are spherocylinders (<code>L/D > 0</code>).<br>
  Number of particles: 686. Click [here](https://user-images.githubusercontent.com/73966482/147893687-04ca7cad-e77b-4e2b-9090-e64f626e0049.png) to zoom the figure in.
</p></em>

![BCC](https://user-images.githubusercontent.com/73966482/147893687-04ca7cad-e77b-4e2b-9090-e64f626e0049.png)

<em><p align="center">
  <b>Figure 01-C</b>. Example of a stretched face-centered cubic structure. Particles are spherocylinders (<code>L/D > 0</code>).<br>
  Number of particles: 500. Click [here](https://user-images.githubusercontent.com/73966482/147893565-400f136d-e9a1-4ad9-bb1f-1994f122655e.png) to zoom the figure in.
</p></em>

![FCC](https://user-images.githubusercontent.com/73966482/147893565-400f136d-e9a1-4ad9-bb1f-1994f122655e.png)

<p align="justify">
  <b>NOTE:</b><i> Please pay attention to choose an initial configuration that matches the valid number of particles for that structure.</i>
</p>

## Files and Folders
<p align="justify">
After choosing the crystalline structure and inserting the values of <code>[1+L/D]&rho;*</code> and <code>L/D</code>, the program will organize the output files and directories.
 The program creates <b>6</b> parent directories in total. To better organize the output files, all directories (or subdirectories) contains a date folder, corresponding to the 
 starting date of the simulation (e.g. <code>20220101</code> means the simulation strated at January 1st, 2022).</p>

<p align="justify">
 The <code>Initial_Configuration/</code> directory and <code>OVITO/</code> subdirectory store the initial configuration file, consisting of position and orientation of   
 particles, as well as the molecular geometry.</p>

<p align="justify">
 The <code>Trajectories/</code> directory stores the trajectory file, consisting of the same properties of the initial configuration file. These properties are written out every 
 <code>n_save</code> cycles. <br><b>NOTE:</b><i> the algorithm creates this directory regardless the users' choice to write out the respective file.</i></p>

<p align="justify">
 The <code>Potential/</code> directory stores the potential energy of the perturbed system. This property is written out every <code>n_save</code> cycles. 
 The algorithm also creates two subfolders for each potential model (Square Well and Kihara) and one attractive/repulsive parameters subfolder for every selected &lambda; and <i>n</i>, respectively. The calculated potential energy is then stored on each respective
 subfolder.</p>

<p align="justify">
 The <code>Ratio/</code> directory stores information on equilibration cycles (acceptance ratio, maximum displacement, and ratio threshold). This information is separated into 
 two subfolders: <code>Rotation/</code> for rotational movements and <code>Translation/</code> for translational movements.</p>

<p align="justify">
 The <code>Order_Parameter/</code> directory stores the nematic order parameter. This property is written out every <code>n_save</code> cycles.
</p>

<p align="justify">
 The <code>Perturbed_Coefficient/</code> directory stores the results generated by the block-average subroutine. Since these results are based on the potential energy of the perturbed system, they are also separated in subfolders based on the potential models and attractive/repulsive parameters. <br><b>NOTE:</b><i> the algorithm creates this directory regardless the users' choice to call the respective subroutine.</i></p>

<p align="justify">
The aforementioned folders are created by executing a shell command via an intrinsic function called <code>SYSTEM</code>. Please note that which shell is used to invoke the 
 command line is system-dependent and environment-dependent. Check this <a href="https://gcc.gnu.org/onlinedocs/gfortran/SYSTEM.html">link</a> for more information.</p>

<p align="justify">
File names are based on the information they hold, followed by the reduced number density and aspect ratio parameters that were used to create them. Files with identical names
 are always overwritten. Thus, running simulations with the same <code>[1+L/D]&rho;*</code> and <code>L/D</code> at the same date will always overwrite existing data.</p>

## Running the Code
<p align="justify">
Because shell commands are executed during simulation and files are opened and written, we recommend Linux's users to run the compiled code with the <code>sudo</code> command
 below to avoid administrative issues.
</p>

```console
sudo ./main.out
```

<p align="justify">
After setting up the molecular structure and organizing folders and files, the algorithm will print out a user-friendly simulation summary. Here the user will be able to 
 review all important parameters (number of cycles, attractive range, reduced variables etc.) prior to the Monte Carlo simulation itself. After checking everything up, the
 user must press a <code>KEY</code> to continue the simulation.
</p>

<p align="justify">
The first simulation goal is to determine any possible molecular overlaps in the initial configuration. The overlap check is made by calculating the shortest distance according 
 to the Vega-Lago (VL) algorithm (<a href="https://doi.org/10.1016/0097-8485(94)80023-5">Vega and Lago, <b>Comput. Chem.</b>, 18, 1, 55-59, 1994</a>). An overlap is detected 
 when the calculated shortest distance is less than or equal to the spherocylinder's diameter (or 1 in reduced units). If that happens, the simulation 
 is immediately interrupted. Otherwise, it proceeds to the Metropolis sampling algorithm (<a href="https://aip.scitation.org/doi/10.1063/1.1699114">Metropolis <i>et al.</i>, 
 <b>J. Chem. Phys.</b>, 21, 1087, 1953</a>).
</p>

<p align="justify">
During a sampling cycle, a particle is randomly selected according to a linear congruential generator (LCG). The LCG is a pseudorandom number generator that yields a sequence of
 randomized numbers from the uniform distribution over the range 0 &#8804; x < 1. Afterwards, a trial move is performed for the selected particle. Trial moves are divided 
 into two equiprobable events: a translational and a rotational displacement. Only one kind of molecular displacement can take place at a time in each cycle. If the 
 translational event is chosen, the selected particle will be randomly translated across the simulation box, limited to a maximum translational displacement (MTD). On the other 
 hand, if the rotational event is chosen, the selected particle will be randomly rotated around its center of mass, limited to a maximum rotational displacement (MRD). 
 Rotations are implemented via quaternions algebra. Read pages 106-111 of 
 <a href="https://oxford.universitypressscholarship.com/view/10.1093/oso/9780198803195.001.0001/oso-9780198803195">Allen and Tildesley (<b>Computer Simulation of Liquids</b>, 
 2nd edition, 2017)</a> for more details.
</p>

<p align="justify">
After randomly displacing a particle, the algorithm proceeds to the Metropolis' criterion, which can be simplified to a single molecular overlap check in the case of hard-core 
 geometries. Thus, the trial move is inspected to check any possible overlapping configurations. If overlap is detected, the trial move is immediately rejected and a new
 cycle begins. Otherwise, the trial move is accepted and the system is updated in terms of position and orientation of the selected particle and potential energy. 
 This energy is computed in accordance with the square-well (SW) potential or the Kihara (KH) potential.
</p>

<p align="justify">
The simulation is splitted into two phases: the equilibration phase and the production phase. During equilibration phase, the maximum displacements (MD) are either positively or 
 negatively adjusted by 5% of their current value. If the number of accepted moves divided by the   
 number of trial moves (acceptance ratio) is higher than a initially fixed threshold of 0.5, then the MDs are positively adjusted, and vice-versa. In some cases, the 
 equilibration phase 
 performs poorly. For instance, for low density systems composed of quasi-spherical particles (<i>i.e.</i>
 <code>L/D = 0.1</code>), most of the trial moves are accepted regarding rotational displacements. In that case, the sampling generally fails to generate overlapping
 configurations and thus the MRD will frequently undergo a positive adjustment. Eventually, the MRD skyrockets to impracticable values, leading to mathematical inaccuracies.
 Therefore, we decided to replace the fixed threshold by a "dynamic threshold". This dynamic threshold is arbitrarily modified everytime the MD values reach a limit. For MTD, 
 the upper limit is the maximum length of the simulation box, while the lower limit is <code>1 &#10799; 10&#8315;&#8309;</code>. For MRD, the upper limit is <code>&pi;</code> 
 (half-turn 
 condition), while the lower limit is <code>2 &#10799; 10&#8315;&#8308; / (1+L/D)</code>. Except for the upper limit of the 
 MRD, the other limits are merely arbitrary. Hence, when the MDs reach the upper limit, the dynamic threshold increases, and when the MDs reach the lower limit, the dynamic 
 threshold decreases.<br><br>
 <b>NOTE:</b><i> Whenever the ratio threshold is modified, the simulation is reset to its initial values (configuration, energy, etc.), except for the current equilibration
 cycle.
</p>

<p align="justify">
During production phase, the potential energy of the perturbed system is computed and the nematic order parameter is calculated. The latter is calculated via a tensor 
 diagonalization 
 method (<a href="https://claudiozannoni.it/cambridge77_opdf.pdf">Zannoni, 1979. In: Luckhurst and Gray (eds.), <b>The Molecular Physics of Liquid Crystals</b>, 1979, pp. 
 51–83</a>).
</p>

<p align="justify">
After completing the Metropolis sampling, the algorithm evokes the block-average subroutine (depending on the user's choice). Read pages 281-287 of 
 <a href="https://oxford.universitypressscholarship.com/view/10.1093/oso/9780198803195.001.0001/oso-9780198803195">Allen and Tildesley (<b>Computer Simulation of Liquids</b>, 
 2nd edition, 2017)</a> for more details. This subroutine estimates the averages and 
 uncertainties of the first- and second-order perturbation coefficients, as well as the total Helmholtz free energy of the perturbed system.
 In the case of the Helmholtz free 
 energy, due to 
 high exponential terms that leads to computational inaccuracies in some machine's architectures, we applied a mathematical relation to replace an exponential sum by a more 
 practicable expression, saving processing time and avoiding overflow errors. Check this <a 
 href="https://aip.scitation.org/doi/suppl/10.1063/1.2165188/suppl_file/supplement.pdf">Supplementary Material (Abreu and Escobedo, <b>J. Chem. Phys.</b>, 124, 054116, 
 2006)</a> for more information.
</p>

<p align="justify">
At the end of the simulation, the program writes out a log file containing all simulation details. Later simulations will only append information to the log file instead of
 overwriting it.
</p>

---

“<i>With thermodynamics, one can calculate almost everything crudely; with kinetic theory, one can calculate fewer things, but more accurately; and with statistical mechanics, one can calculate almost nothing exactly.</i>” -- Eugene P. Wigner
